node {
    stage('SCM Checkout'){
        script{
            try{
                git 'https://github.com/hemersonallan/APIProducts'
                echo 'Projeto Clonado'
             }catch (Exception e) {
                echo 'Erro ao Clonar : ' + e.toString()
             }   
             echo 'Estagio 1 Finalizado'
        }
    }
    stage('Stop Http servers'){
         script{
            try{
                sh 'fuser -n tcp -k 8081'
                echo 'Processos na porta 8081 finalizados !!!' 
             }catch (Exception e) {
                echo 'Erro finalizando processos Http: ' + e.toString()
             }   
             echo 'Estagio 2 Finalizado'
        }       
    }  
}
    /*          script{
                    try{
                        sh 'rm -r -f /var/lib/jenkins/workspace/DEV-project/APIProducts/'
                        echo 'Pasta APIProducts removida !!!'
                        sh 'fuser -n tcp -k 8081'
                        echo 'Processos na porta 8081 finalizados !!!'              
                    }catch (Exception e) {
                        echo 'Merda ao Finalizar : ' + e.toString()
                    }
                }        
                echo 'Build Anterior Removida !!!'  
            }   
        }
        stage('Clonando Projeto') {
            steps{
               // 
                sh 'git clone https://github.com/hemersonallan/APIProducts.git'
                echo 'Projeto Clonado'
            }    
        }
        stage("Deploy"){
             steps{
                 dir('/var/lib/jenkins/workspace/DEV-project/APIProducts/productsapi') {
                    withEnv(['JENKINS_NODE_COOKIE=dontkill']) {
                        sh 'chmod +x mvnw'
                        sh 'nohup ./mvnw spring-boot:run -Dserver.port=8081  -DskipTests &'
                        echo 'Deploy Realizado com Sucesso!!!'
                        sleep(15)
                    }
                }
            }      
        }               
        stage('Observability'){
            steps{
                sh 'curl -i -l http://3.133.161.133:8081'
                echo 'Observability ok!!!'
            }
        }
    }    
}
*/

